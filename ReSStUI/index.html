<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <meta charset="UTF-8">
    <title>ReSStUI</title>
    <link rel="dns-prefetch" href="unpkg.com"/>
    <link rel="dns-prefetch" href="fonts.googleapis.com"/>
</head>

<body>
    <div id="app">
        <md-toolbar class="md-dense">
            <md-button :href="backto" v-if="backto" class="md-icon-button" aria-label="Back">
                <md-icon>arrow_back</md-icon>
            </md-button>

            <router-link to="/" class="md-title" style="flex: 1" tag="h2">
                ReSStUI
            </router-link>

            <router-link tag="md-button" to="/settings" class="md-icon-button" aria-label="Settings">
                <md-icon>settings</md-icon>
            </router-link>
        </md-toolbar>
        <div class="main-content">
            <transition :name="transitionName">
                <router-view></router-view>
            </transition>
        </div>
        <resstplugins></resstplugins>
    </div>
    <script async>
        (()=> {
            const VERSION = 0.002;
            window.APP_VERSION  = VERSION;
            window.APP_START_TIME = new Date().getTime();
            const DEBUG = window.location.toString().includes('debug=1');
            if (DEBUG) localStorage.setItem('version', new Date().getTime());
            const updated = localStorage.getItem('version') == VERSION;
            const loadCodeFromCache = path => {
                localStorage.setItem('version', VERSION);
                const text = localStorage.getItem(path);
                if (text && updated) return Promise.resolve({ path, text });
                return fetch(path).then(response => response.text()).then(text => {
                    localStorage.setItem(path, text);
                    return { path, text };
                });
            };
            window.loadCodeFromCache = loadCodeFromCache;
            const evaluate = js => {
                try {eval(js.text);}
                catch (e) {console.log(js.path, js.text, e);}
            };
            const loadStyle = style => {
                const element = document.createElement("style");
                element.setAttribute("type", "text/css");
                element.textContent = style.text.replace('sourceMappingURL=', '');
                document.getElementsByTagName("head")[0].appendChild(element);
            };
            Promise.all(
                [
                    loadCodeFromCache('//fonts.googleapis.com/icon?family=Material+Icons'),
                    loadCodeFromCache('//cdn.jsdelivr.net/npm/vue-material@0.8.1/dist/vue-material.min.css'),
                    loadCodeFromCache('style.css')
                ]
            ).then(styles => styles.forEach(loadStyle));
            Promise.all(
                [
                    loadCodeFromCache('//unpkg.com/vue@2.5.13/dist/vue.min.js'),
                    loadCodeFromCache('//unpkg.com/vuex@3.0.1/dist/vuex.min.js'),
                    loadCodeFromCache('//unpkg.com/vue-router@3.0.1/dist/vue-router.min.js'),
                    loadCodeFromCache('//cdn.jsdelivr.net/npm/vue-material@0.8.1/dist/vue-material.min.js'),
                    loadCodeFromCache('index.js')
                ]
            ).then(jss => jss.forEach(evaluate));
        })();
    </script>
</body>

</html>